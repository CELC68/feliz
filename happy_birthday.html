<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>¡Feliz Cumpleaños!</title>
  <style>
    html,body{height:100%;margin:0;font-family:Inter,system-ui, -apple-system, 'Segoe UI', Roboto, Arial;color:#000;background:linear-gradient(180deg,#ffe2b8 0%, #ffcf8d 100%);overflow:hidden}
    .stage{position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:18px}
    .card{background:rgba(255,255,255,0.95);padding:24px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,0.12);text-align:center;max-width:900px;width:86%}
    h1{font-size:clamp(24px,4vw,48px);margin:0 0 6px 0}
    p.lead{margin:0 0 12px 0;opacity:0.9}
    .controls{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:12px}
    .btn{background:linear-gradient(90deg,#ff7ab6,#ffd27a);border:none;padding:10px 16px;border-radius:999px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#fff;border:1px solid rgba(0,0,0,0.06)}
    canvas#fireworks{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:1}
    .balloon-area{position:fixed;left:0;bottom:-20vh;right:0;height:120vh;pointer-events:none;z-index:2;overflow:visible}
    .balloon{position:absolute;bottom:-20vh;border-radius:50%;opacity:0.95;box-shadow:0 8px 20px rgba(0,0,0,0.08)}
    @keyframes floatUp{0%{transform:translateY(0) rotate(-6deg)}50%{transform:translateY(-30vh) rotate(6deg)}100%{transform:translateY(-130vh) rotate(-4deg);opacity:0}}
    #envelopeContainer{position:relative;cursor:pointer;z-index:5;text-align:center;}
    #envelope{width:320px;max-width:72vw;margin:0 auto;transition:transform .6s ease;transform-origin:center top}
    #envelope.open{transform:translateY(-24px) rotateX(18deg) scale(0.99)}
    #flap{transition:transform .6s ease;transform-origin:100px 24px}
    #envelope.open #flap{transform:translateY(-6px) rotateX(180deg)}
    .photo-slot{position:absolute;width:160px;height:160px;border-radius:12px;overflow:hidden;background:#fff;border:3px dashed rgba(0,0,0,0.06);box-shadow:0 6px 18px rgba(0,0,0,0.08);z-index:6}
    .photo-slot img{width:100%;height:100%;object-fit:cover;display:block}
    .slot-tl{top:18px;left:18px}
    .slot-tr{top:18px;right:18px}
    .slot-bl{bottom:18px;left:18px}
    @media (max-width:700px){.photo-slot{width:120px;height:120px} #envelope{width:260px}}
  </style>
</head>
<body>
  <canvas id="fireworks"></canvas>
  <div class="balloon-area" id="balloonArea"></div>

  <!-- Fotos colocadas en las esquinas (tus imágenes) -->
  <div class="photo-slot slot-tl"><img src="foto1.jpg" alt="Foto1.png"></div>
  <div class="photo-slot slot-tr"><img src="foto2.jpg" alt="Foto2.png"></div>
  <div class="photo-slot slot-bl"><img src="foto3.jpg" alt="Foto2.png"></div>

  <div class="stage">
    <div id="envelopeContainer">
      <div id="envelope" aria-hidden="true">
        <svg viewBox="0 0 200 140" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:auto;display:block">
          <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#fff"/><stop offset="1" stop-color="#ffe"/></linearGradient></defs>
          <rect x="4" y="24" width="192" height="112" rx="10" fill="url(#g1)" stroke="#e2d8c8" stroke-width="2"/>
          <polygon id="flap" points="6,24 100,86 194,24" fill="#ffd" stroke="#e2d8c8" stroke-width="2"/>
        </svg>
      </div>
      <p id="envelopeHint" style="margin-top:10px;color:rgba(0,0,0,0.7)">Haz clic para abrir la carta</p>
    </div>

    <div class="card" id="mainCard" style="display:none;z-index:5;">
      <h1 id="title">¡Feliz Cumpleaños Papi Mauro, Abuelita Isabel y Aarón!</h1>
      <p class="lead" id="subtitle">Que tu día esté lleno de alegría, sorpresas y mucho amor.</p>

      <div class="controls">
        <button class="btn" id="startBtn">Iniciar celebración</button>
        <button class="btn secondary" id="stopBtn">Detener</button>
        <button class="btn secondary" id="changeBtn">Editar mensaje</button>
      </div>
    </div>
  </div>

  <!-- Audio: tu archivo -->
  <audio id="music" preload="auto" loop>
    <source src="audio1.mp3" type="audio/mpeg">
  </audio>

  <script>
    function random(min,max){return Math.random()*(max-min)+min}
    const envelopeContainer = document.getElementById('envelopeContainer');
    const envelope = document.getElementById('envelope');
    const mainCard = document.getElementById('mainCard');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const changeBtn = document.getElementById('changeBtn');
    const music = document.getElementById('music');
    const balloonArea = document.getElementById('balloonArea');

    envelopeContainer.addEventListener('click', () => {
      envelope.classList.add('open');
      document.getElementById('envelopeHint').textContent = 'Abriendo...';
      setTimeout(() => {
        envelopeContainer.style.display = 'none';
        mainCard.style.display = 'block';
        music.play().catch(()=>{});
      }, 700);
    });

    function createBalloon(color){
      const b = document.createElement('div');
      b.className = 'balloon';
      const size = random(40,90);
      b.style.width = size + 'px';
      b.style.height = (size*1.25) + 'px';
      b.style.left = random(5,90) + '%';
      b.style.background = 'radial-gradient(circle at 30% 20%, rgba(255,255,255,0.9), rgba(255,255,255,0.02) 30%), ' + color;
      b.style.animation = 'floatUp ' + random(8,18) + 's linear forwards';
      balloonArea.appendChild(b);
      setTimeout(()=> b.remove(), 22000);
    }
    function spawnBalloons(n){ const palette = ['#ff6b6b','#ffd166','#6bcBff','#9b8cff','#ff9fd6','#7ee7c7']; for(let i=0;i<n;i++) createBalloon(palette[Math.floor(Math.random()*palette.length)]); }

    const canvas = document.getElementById('fireworks');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = innerWidth;
    let H = canvas.height = innerHeight;
    window.addEventListener('resize', ()=>{W=canvas.width=innerWidth;H=canvas.height=innerHeight;});

    class Spark {
      constructor(x,y,dx,dy,color,size){ this.x=x;this.y=y;this.dx=dx;this.dy=dy;this.life=1;this.decay=random(0.015,0.035);this.color=color;this.size=size; }
      update(){ this.x+=this.dx; this.y+=this.dy; this.dy += 0.03; this.dx *= 0.995; this.life -= this.decay; }
      draw(){ ctx.globalAlpha = Math.max(0, this.life); ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x,this.y,Math.max(0, this.size*this.life), 0, Math.PI*2); ctx.fill(); }
    }

    let sparks = [];
    function launchFirework(x=null,y=null){
      const fx = x===null ? random(W*0.15,W*0.85) : x;
      const fy = y===null ? random(H*0.15,H*0.6) : y;
      const hue = Math.floor(random(0,360));
      const count = Math.floor(random(60,120));
      for(let i=0;i<count;i++){
        const angle = Math.random()*Math.PI*2;
        const speed = random(1.5,6.5);
        const dx = Math.cos(angle)*speed;
        const dy = Math.sin(angle)*speed;
        const color = 'hsl(' + (hue + random(-30,30)) + ', 95%, ' + random(45,60) + '%)';
        sparks.push(new Spark(fx,fy,dx,dy,color, random(1.5,3.2)));
      }
    }

    let lastLaunch = 0;
    let running = false;
    function frame(t){
      ctx.fillStyle = 'rgba(255,255,255,0.2)';
      ctx.fillRect(0,0,W,H);
      for(let i=sparks.length-1;i>=0;i--){ sparks[i].update(); sparks[i].draw(); if(sparks[i].life<=0) sparks.splice(i,1); }
      if(running && t - lastLaunch > random(400,1200)){ launchFirework(); lastLaunch = t; if(Math.random()<0.6) spawnBalloons(Math.floor(random(1,4))); }
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);

    startBtn.addEventListener('click', ()=>{
      music.play().catch(()=>{});
      running = true; lastLaunch = performance.now();
      for(let i=0;i<3;i++) setTimeout(()=>launchFirework(), i*250);
      spawnBalloons(10);
    });
    stopBtn.addEventListener('click', ()=>{
      running = false; sparks = []; document.querySelectorAll('.balloon').forEach(b=>b.remove()); music.pause(); music.currentTime=0;
    });

    changeBtn.addEventListener('click', ()=>{
      const t = prompt('Encabezado:', document.getElementById('title').textContent);
      const s = prompt('Subtítulo:', document.getElementById('subtitle').textContent);
      if(t) document.getElementById('title').textContent = t;
      if(s) document.getElementById('subtitle').textContent = s;
    });

    canvas.addEventListener('click',(e)=>{
      const rect = canvas.getBoundingClientRect();
      launchFirework(e.clientX - rect.left, e.clientY - rect.top);
    });
  </script>
</body>
</html>
